<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥èº«è®­ç»ƒç®¡ç†åå°</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f5f5f7;
            color: #1d1d1f;
        }

        .header {
            background: #fff;
            padding: 1rem 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .tabs {
            display: flex;
            background: #fff;
            border-radius: 12px;
            padding: 0.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 0.75rem 1rem;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .tab.active {
            background: #007aff;
            color: white;
        }

        .tab:hover:not(.active) {
            background: #f0f0f0;
        }

        .section {
            background: #fff;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section h2 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: #1d1d1f;
        }

        .btn {
            background: #007aff;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #0056d3;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #ff3b30;
        }

        .btn-danger:hover {
            background: #d70015;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d1d6;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-control:focus {
            outline: none;
            border-color: #007aff;
        }

        .exercise-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }

        .exercise-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.2s;
        }

        .exercise-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .exercise-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .exercise-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .exercise-bodypart {
            color: #8e8e93;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .exercise-description {
            color: #48484a;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .workout-item {
            padding: 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .workout-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .exercise-set {
            display: flex;
            gap: 1rem;
            align-items: center;
            padding: 0.5rem;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 0.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card.highlight {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }

        .stat-icon {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.5rem;
            opacity: 0.7;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .file-upload {
            border: 2px dashed #d1d1d6;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .file-upload:hover {
            border-color: #007aff;
            background: #f0f8ff;
        }

        .file-upload.dragover {
            border-color: #007aff;
            background: #f0f8ff;
        }

        .hidden {
            display: none;
        }

        /* å›¾è¡¨æ ·å¼ */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .chart-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .chart-section h3 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        /* è®­ç»ƒæ—¥å†æ ·å¼ */
        .calendar-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .training-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .calendar-day {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 0.8rem;
            text-align: center;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition: all 0.2s;
        }

        .calendar-day.has-workout {
            background: linear-gradient(135deg, #4CAF50, #81C784);
            color: white;
        }

        .calendar-day.today {
            border: 2px solid #007aff;
            background: #e3f2fd;
        }

        .day-date {
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .day-info {
            font-size: 0.8rem;
        }

        .workout-count {
            color: rgba(255,255,255,0.9);
        }

        .calories {
            color: rgba(255,255,255,0.8);
        }

        /* æœ€è¿‘è®­ç»ƒè®°å½•æ ·å¼ */
        .recent-workouts {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .workout-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1rem;
        }

        .workout-item {
            display: grid;
            grid-template-columns: 120px 1fr auto auto;
            gap: 1rem;
            align-items: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .workout-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .workout-date {
            font-weight: 600;
            color: #666;
        }

        .workout-name {
            font-weight: 500;
            color: #333;
        }

        .workout-stats {
            display: flex;
            gap: 1rem;
            font-size: 0.9rem;
            color: #666;
        }

        .workout-status {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            background: #ffc107;
            color: #333;
        }

        .workout-status.completed {
            background: #28a745;
            color: white;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .exercise-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }

            .charts-container {
                grid-template-columns: 1fr;
            }

            .training-calendar {
                grid-template-columns: repeat(7, 1fr);
                gap: 0.2rem;
            }

            .calendar-day {
                min-height: 60px;
                padding: 0.5rem;
                font-size: 0.8rem;
            }

            .workout-item {
                grid-template-columns: 1fr;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="header">
            <h1>å¥èº«è®­ç»ƒç®¡ç†åå°</h1>
        </div>

        <div class="container">
            <div class="tabs">
                <div class="tab" :class="{active: activeTab === 'exercises'}" @click="activeTab = 'exercises'">
                    åŠ¨ä½œç®¡ç†
                </div>
                <div class="tab" :class="{active: activeTab === 'workouts'}" @click="activeTab = 'workouts'">
                    è®­ç»ƒè®¡åˆ’
                </div>
                <div class="tab" :class="{active: activeTab === 'sessions'}" @click="activeTab = 'sessions'">
                    è®­ç»ƒè®°å½•
                </div>
                <div class="tab" :class="{active: activeTab === 'statistics'}" @click="activeTab = 'statistics'">
                    æ•°æ®ç»Ÿè®¡
                </div>
            </div>

            <!-- åŠ¨ä½œç®¡ç† -->
            <div v-show="activeTab === 'exercises'">
                <div class="section">
                    <h2>åŠ¨ä½œç®¡ç†</h2>
                    <button class="btn" @click="showAddExerciseModal = true">æ·»åŠ æ–°åŠ¨ä½œ</button>
                </div>

                <div class="exercise-grid">
                    <div v-for="exercise in exercises" :key="exercise.id" class="exercise-card">
                        <img v-if="exercise.imageUrl" :src="exercise.imageUrl" :alt="exercise.name" class="exercise-image">
                        <div v-else class="exercise-image" style="background: #f0f0f0; display: flex; align-items: center; justify-content: center; color: #8e8e93;">
                            æš‚æ— å›¾ç‰‡
                        </div>
                        <div class="exercise-name">{{ exercise.name }}</div>
                        <div class="exercise-bodypart">{{ exercise.bodyPart }}</div>
                        <div class="exercise-description">{{ exercise.description }}</div>
                        <div class="card-actions">
                            <button class="btn" @click="editExercise(exercise)">ç¼–è¾‘</button>
                            <button class="btn btn-danger" @click="deleteExercise(exercise.id)">åˆ é™¤</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è®­ç»ƒè®¡åˆ’ -->
            <div v-show="activeTab === 'workouts'">
                <div class="section">
                    <h2>è®­ç»ƒè®¡åˆ’</h2>
                    <button class="btn" @click="showAddWorkoutModal = true">åˆ›å»ºæ–°è®¡åˆ’</button>
                </div>

                <div v-for="workout in workouts" :key="workout.id" class="workout-item">
                    <div class="workout-name">{{ workout.name }}</div>
                    <div style="color: #8e8e93; margin-bottom: 1rem;">{{ workout.bodyPart }} - {{ workout.description }}</div>
                    <div v-for="exercise in workout.exercises" :key="exercise.exerciseId" class="exercise-set">
                        <span>{{ getExerciseName(exercise.exerciseId) }}</span>
                        <span>{{ exercise.sets }}ç»„ x {{ exercise.reps }}æ¬¡</span>
                        <span v-if="exercise.weight">{{ exercise.weight }}kg</span>
                        <span>ä¼‘æ¯{{ exercise.restTime }}s</span>
                    </div>
                    <div class="card-actions">
                        <button class="btn" @click="editWorkout(workout)">ç¼–è¾‘</button>
                        <button class="btn btn-danger" @click="deleteWorkout(workout.id)">åˆ é™¤</button>
                        <button class="btn" @click="startWorkout(workout)">å¼€å§‹è®­ç»ƒ</button>
                    </div>
                </div>
            </div>

            <!-- è®­ç»ƒè®°å½• -->
            <div v-show="activeTab === 'sessions'">
                <div class="section">
                    <h2>è®­ç»ƒè®°å½•</h2>
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <input type="date" v-model="filterStartDate" class="form-control" style="width: auto;">
                        <input type="date" v-model="filterEndDate" class="form-control" style="width: auto;">
                        <button class="btn" @click="filterSessions">ç­›é€‰</button>
                    </div>
                </div>

                <div v-for="session in sessions" :key="session.id" class="workout-item">
                    <div class="workout-name">{{ getWorkoutName(session.workoutId) }}</div>
                    <div style="color: #8e8e93; margin-bottom: 1rem;">
                        {{ formatDate(session.date) }} | 
                        {{ formatTime(session.startTime) }} - {{ formatTime(session.endTime) }} |
                        æ€»æ—¶é•¿: {{ formatDuration(session.totalTime) }}
                    </div>
                    <div v-if="session.isCompleted" style="color: #34c759; font-weight: 600;">âœ“ å·²å®Œæˆ</div>
                    <div v-else style="color: #ff9500; font-weight: 600;">è¿›è¡Œä¸­</div>
                </div>
            </div>

            <!-- æ•°æ®ç»Ÿè®¡ -->
            <div v-show="activeTab === 'statistics'">
                <div class="section">
                    <h2>ğŸ“Š æ•°æ®ç»Ÿè®¡åˆ†æ</h2>
                </div>

                <!-- æ¦‚è§ˆå¡ç‰‡ -->
                <div class="stats-grid">
                    <div class="stat-card highlight">
                        <div class="stat-value">{{ statistics.todayStats?.workoutCount || 0 }}</div>
                        <div class="stat-label">ä»Šæ—¥è®­ç»ƒæ¬¡æ•°</div>
                        <div class="stat-icon">ğŸ‹ï¸â€â™‚ï¸</div>
                    </div>
                    <div class="stat-card highlight">
                        <div class="stat-value">{{ formatDuration(statistics.todayStats?.totalTime || 0) }}</div>
                        <div class="stat-label">ä»Šæ—¥è®­ç»ƒæ—¶é•¿</div>
                        <div class="stat-icon">â±ï¸</div>
                    </div>
                    <div class="stat-card highlight">
                        <div class="stat-value">{{ Math.round(statistics.todayStats?.totalCalories || 0) }}</div>
                        <div class="stat-label">ä»Šæ—¥æ¶ˆè€—å¡è·¯é‡Œ</div>
                        <div class="stat-icon">ğŸ”¥</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ statistics.weekStats?.workoutCount || 0 }}</div>
                        <div class="stat-label">æœ¬å‘¨è®­ç»ƒæ¬¡æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ Math.round(statistics.weekStats?.totalCalories || 0) }}</div>
                        <div class="stat-label">æœ¬å‘¨æ¶ˆè€—å¡è·¯é‡Œ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ statistics.monthStats?.workoutCount || 0 }}</div>
                        <div class="stat-label">æœ¬æœˆè®­ç»ƒæ¬¡æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ Math.round(statistics.monthStats?.totalCalories || 0) }}</div>
                        <div class="stat-label">æœ¬æœˆæ¶ˆè€—å¡è·¯é‡Œ</div>
                    </div>
                </div>

                <!-- å›¾è¡¨åŒºåŸŸ -->
                <div class="charts-container">
                    <div class="chart-section">
                        <h3>ğŸ“ˆ å¡è·¯é‡Œæ¶ˆè€—è¶‹åŠ¿ï¼ˆæœ€è¿‘7å¤©ï¼‰</h3>
                        <div class="chart-wrapper">
                            <canvas id="caloriesChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-section">
                        <h3>â° è®­ç»ƒæ—¶é•¿ç»Ÿè®¡ï¼ˆæœ€è¿‘7å¤©ï¼‰</h3>
                        <div class="chart-wrapper">
                            <canvas id="durationChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-section">
                        <h3>ğŸ¯ åŠ¨ä½œåˆ†å¸ƒ</h3>
                        <div class="chart-wrapper">
                            <canvas id="exerciseChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-section">
                        <h3>ğŸ’ª èº«ä½“éƒ¨ä½è®­ç»ƒæ¯”ä¾‹</h3>
                        <div class="chart-wrapper">
                            <canvas id="bodyPartChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- è®­ç»ƒæ—¥å† -->
                <div class="calendar-section">
                    <h3>ğŸ“… è®­ç»ƒæ—¥å†</h3>
                    <div class="training-calendar">
                        <div v-for="day in recentDays" :key="day.date" class="calendar-day" 
                             :class="{ 'has-workout': day.hasWorkout, 'today': day.isToday }">
                            <div class="day-date">{{ day.displayDate }}</div>
                            <div class="day-info" v-if="day.hasWorkout">
                                <div class="workout-count">{{ day.workoutCount }}æ¬¡</div>
                                <div class="calories">{{ Math.round(day.totalCalories) }}å¡</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æœ€è¿‘è®­ç»ƒè®°å½• -->
                <div class="recent-workouts">
                    <h3>ğŸƒâ€â™‚ï¸ æœ€è¿‘è®­ç»ƒè®°å½•</h3>
                    <div class="workout-list">
                        <div v-for="session in recentSessions" :key="session.id" class="workout-item">
                            <div class="workout-date">{{ formatDate(session.date) }}</div>
                            <div class="workout-name">{{ getWorkoutName(session.workoutId) }}</div>
                            <div class="workout-stats">
                                <span class="duration">{{ formatDuration(session.totalTime) }}</span>
                                <span class="calories">{{ Math.round(session.totalCalories || 0) }}å¡</span>
                            </div>
                            <div class="workout-status" :class="{ completed: session.isCompleted }">
                                {{ session.isCompleted ? 'âœ… å·²å®Œæˆ' : 'â¸ï¸ æœªå®Œæˆ' }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ·»åŠ /ç¼–è¾‘åŠ¨ä½œæ¨¡æ€æ¡† -->
        <div v-if="showAddExerciseModal || showEditExerciseModal" class="modal" @click.self="closeExerciseModal">
            <div class="modal-content">
                <h2>{{ showEditExerciseModal ? 'ç¼–è¾‘åŠ¨ä½œ' : 'æ·»åŠ æ–°åŠ¨ä½œ' }}</h2>
                
                <div class="form-group">
                    <label>åŠ¨ä½œåç§°</label>
                    <input type="text" v-model="exerciseForm.name" class="form-control">
                </div>

                <div class="form-group">
                    <label>èº«ä½“éƒ¨ä½</label>
                    <select v-model="exerciseForm.bodyPart" class="form-control">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="èƒ¸éƒ¨">èƒ¸éƒ¨</option>
                        <option value="èƒŒéƒ¨">èƒŒéƒ¨</option>
                        <option value="è…¿éƒ¨">è…¿éƒ¨</option>
                        <option value="è‚©éƒ¨">è‚©éƒ¨</option>
                        <option value="æ‰‹è‡‚">æ‰‹è‡‚</option>
                        <option value="è…¹éƒ¨">è…¹éƒ¨</option>
                        <option value="å…¨èº«">å…¨èº«</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>åŠ¨ä½œæè¿°</label>
                    <textarea v-model="exerciseForm.description" class="form-control" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label>åŠ¨ä½œå›¾ç‰‡/GIF</label>
                    <div class="file-upload" @click="$refs.fileInput.click()" 
                         @dragover.prevent="onDragOver" 
                         @dragleave.prevent="onDragLeave" 
                         @drop.prevent="onDrop">
                        <div v-if="exerciseForm.imageUrl">
                            <img :src="exerciseForm.imageUrl" style="max-width: 200px; max-height: 200px;">
                            <p>ç‚¹å‡»æˆ–æ‹–æ‹½æ›´æ¢å›¾ç‰‡</p>
                        </div>
                        <div v-else>
                            <p>ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </p>
                            <p style="color: #8e8e93; font-size: 0.9rem;">æ”¯æŒ JPG, PNG, GIF æ ¼å¼</p>
                        </div>
                    </div>
                    <input ref="fileInput" type="file" @change="onFileSelect" accept="image/*" class="hidden">
                </div>

                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                    <button class="btn" style="background: #8e8e93;" @click="closeExerciseModal">å–æ¶ˆ</button>
                    <button class="btn" @click="saveExercise">ä¿å­˜</button>
                </div>
            </div>
        </div>

        <!-- æ·»åŠ /ç¼–è¾‘è®­ç»ƒè®¡åˆ’æ¨¡æ€æ¡† -->
        <div v-if="showAddWorkoutModal || showEditWorkoutModal" class="modal" @click.self="closeWorkoutModal">
            <div class="modal-content">
                <h2>{{ showEditWorkoutModal ? 'ç¼–è¾‘è®­ç»ƒè®¡åˆ’' : 'åˆ›å»ºæ–°è®­ç»ƒè®¡åˆ’' }}</h2>
                
                <div class="form-group">
                    <label>è®¡åˆ’åç§°</label>
                    <input type="text" v-model="workoutForm.name" class="form-control">
                </div>

                <div class="form-group">
                    <label>ç›®æ ‡éƒ¨ä½</label>
                    <select v-model="workoutForm.bodyPart" class="form-control">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="èƒ¸éƒ¨">èƒ¸éƒ¨</option>
                        <option value="èƒŒéƒ¨">èƒŒéƒ¨</option>
                        <option value="è…¿éƒ¨">è…¿éƒ¨</option>
                        <option value="è‚©éƒ¨">è‚©éƒ¨</option>
                        <option value="æ‰‹è‡‚">æ‰‹è‡‚</option>
                        <option value="è…¹éƒ¨">è…¹éƒ¨</option>
                        <option value="å…¨èº«">å…¨èº«</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>è®¡åˆ’æè¿°</label>
                    <textarea v-model="workoutForm.description" class="form-control" rows="2"></textarea>
                </div>

                <div class="form-group">
                    <label>è®­ç»ƒåŠ¨ä½œ</label>
                    <div v-for="(exercise, index) in workoutForm.exercises" :key="index" class="exercise-set">
                        <select v-model="exercise.exerciseId" class="form-control" style="width: auto;">
                            <option value="">é€‰æ‹©åŠ¨ä½œ</option>
                            <option v-for="ex in exercises" :key="ex.id" :value="ex.id">{{ ex.name }}</option>
                        </select>
                        <input type="number" v-model="exercise.sets" placeholder="ç»„æ•°" class="form-control" style="width: 80px;">
                        <input type="number" v-model="exercise.reps" placeholder="æ¬¡æ•°" class="form-control" style="width: 80px;">
                        <input type="number" v-model="exercise.weight" placeholder="é‡é‡" class="form-control" style="width: 80px;">
                        <input type="number" v-model="exercise.restTime" placeholder="ä¼‘æ¯(ç§’)" class="form-control" style="width: 100px;">
                        <button class="btn btn-danger" @click="removeExerciseFromWorkout(index)">åˆ é™¤</button>
                    </div>
                    <button class="btn" @click="addExerciseToWorkout">æ·»åŠ åŠ¨ä½œ</button>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                    <button class="btn" style="background: #8e8e93;" @click="closeWorkoutModal">å–æ¶ˆ</button>
                    <button class="btn" @click="saveWorkout">ä¿å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    activeTab: 'exercises',
                    exercises: [],
                    workouts: [],
                    sessions: [],
                    statistics: {},
                    
                    // å›¾è¡¨å®ä¾‹
                    charts: {
                        calories: null,
                        duration: null,
                        exercise: null,
                        bodyPart: null
                    },
                    
                    // æ—¥å†å’Œæœ€è¿‘è®°å½•æ•°æ®
                    recentDays: [],
                    recentSessions: [],
                    
                    // æ¨¡æ€æ¡†çŠ¶æ€
                    showAddExerciseModal: false,
                    showEditExerciseModal: false,
                    showAddWorkoutModal: false,
                    showEditWorkoutModal: false,
                    
                    // è¡¨å•æ•°æ®
                    exerciseForm: {
                        id: '',
                        name: '',
                        description: '',
                        bodyPart: '',
                        imageUrl: ''
                    },
                    workoutForm: {
                        id: '',
                        name: '',
                        description: '',
                        bodyPart: '',
                        exercises: []
                    },
                    
                    // ç­›é€‰
                    filterStartDate: '',
                    filterEndDate: ''
                }
            },
            
            computed: {
                // æ ¼å¼åŒ–æ—¶é•¿æ˜¾ç¤º
                formatDuration() {
                    return (seconds) => {
                        if (!seconds) return '0åˆ†é’Ÿ';
                        const minutes = Math.floor(seconds / 60);
                        const remainingSeconds = seconds % 60;
                        if (minutes > 0) {
                            return remainingSeconds > 0 ? `${minutes}åˆ†${remainingSeconds}ç§’` : `${minutes}åˆ†é’Ÿ`;
                        }
                        return `${remainingSeconds}ç§’`;
                    };
                },
                
                // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
                formatDate() {
                    return (dateString) => {
                        const date = new Date(dateString);
                        const now = new Date();
                        const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
                        
                        if (diffDays === 0) return 'ä»Šå¤©';
                        if (diffDays === 1) return 'æ˜¨å¤©';
                        if (diffDays < 7) return `${diffDays}å¤©å‰`;
                        return date.toLocaleDateString('zh-CN');
                    };
                }
            },
            
            methods: {
                async loadExercises() {
                    try {
                        const response = await axios.get('/api/exercises');
                        this.exercises = response.data || [];
                    } catch (error) {
                        console.error('åŠ è½½åŠ¨ä½œå¤±è´¥:', error);
                    }
                },
                
                async loadWorkouts() {
                    try {
                        const response = await axios.get('/api/workouts');
                        this.workouts = response.data || [];
                    } catch (error) {
                        console.error('åŠ è½½è®­ç»ƒè®¡åˆ’å¤±è´¥:', error);
                    }
                },
                
                async loadSessions() {
                    try {
                        const response = await axios.get('/api/sessions');
                        this.sessions = response.data || [];
                    } catch (error) {
                        console.error('åŠ è½½è®­ç»ƒè®°å½•å¤±è´¥:', error);
                    }
                },
                
                async loadStatistics() {
                    try {
                        const response = await axios.get('/api/statistics');
                        this.statistics = response.data || {};
                        
                        // åŠ è½½å®Œç»Ÿè®¡æ•°æ®ååˆå§‹åŒ–å›¾è¡¨å’Œæ—¥å†æ•°æ®
                        this.$nextTick(() => {
                            this.initializeCharts();
                            this.generateRecentDays();
                            this.loadRecentSessions();
                        });
                    } catch (error) {
                        console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                    }
                },
                
                // åˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨
                initializeCharts() {
                    this.initCaloriesChart();
                    this.initDurationChart();
                    this.initExerciseChart();
                    this.initBodyPartChart();
                },
                
                // å¡è·¯é‡Œè¶‹åŠ¿å›¾
                initCaloriesChart() {
                    const ctx = document.getElementById('caloriesChart');
                    if (!ctx) return;
                    
                    if (this.charts.calories) {
                        this.charts.calories.destroy();
                    }
                    
                    // ç”Ÿæˆæœ€è¿‘7å¤©çš„æ•°æ®
                    const last7Days = this.getLast7DaysData();
                    
                    this.charts.calories = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: last7Days.map(day => day.label),
                            datasets: [{
                                label: 'æ¶ˆè€—å¡è·¯é‡Œ',
                                data: last7Days.map(day => day.calories),
                                borderColor: '#ff6b6b',
                                backgroundColor: 'rgba(255, 107, 107, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                },
                
                // è®­ç»ƒæ—¶é•¿å›¾è¡¨
                initDurationChart() {
                    const ctx = document.getElementById('durationChart');
                    if (!ctx) return;
                    
                    if (this.charts.duration) {
                        this.charts.duration.destroy();
                    }
                    
                    const last7Days = this.getLast7DaysData();
                    
                    this.charts.duration = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: last7Days.map(day => day.label),
                            datasets: [{
                                label: 'è®­ç»ƒæ—¶é•¿(åˆ†é’Ÿ)',
                                data: last7Days.map(day => Math.round(day.duration / 60)),
                                backgroundColor: 'rgba(54, 162, 235, 0.8)',
                                borderColor: 'rgba(54, 162, 235, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                },
                
                // åŠ¨ä½œåˆ†å¸ƒé¥¼å›¾
                initExerciseChart() {
                    const ctx = document.getElementById('exerciseChart');
                    if (!ctx) return;
                    
                    if (this.charts.exercise) {
                        this.charts.exercise.destroy();
                    }
                    
                    const exerciseStats = this.getExerciseStats();
                    
                    this.charts.exercise = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: exerciseStats.labels,
                            datasets: [{
                                data: exerciseStats.data,
                                backgroundColor: [
                                    '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', 
                                    '#ffeaa7', '#dda0dd', '#98d8c8', '#f7dc6f'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                },
                
                // èº«ä½“éƒ¨ä½è®­ç»ƒæ¯”ä¾‹
                initBodyPartChart() {
                    const ctx = document.getElementById('bodyPartChart');
                    if (!ctx) return;
                    
                    if (this.charts.bodyPart) {
                        this.charts.bodyPart.destroy();
                    }
                    
                    const bodyPartStats = this.getBodyPartStats();
                    
                    this.charts.bodyPart = new Chart(ctx, {
                        type: 'polarArea',
                        data: {
                            labels: bodyPartStats.labels,
                            datasets: [{
                                data: bodyPartStats.data,
                                backgroundColor: [
                                    'rgba(255, 107, 107, 0.8)',
                                    'rgba(78, 205, 196, 0.8)',
                                    'rgba(69, 183, 209, 0.8)',
                                    'rgba(150, 206, 180, 0.8)',
                                    'rgba(255, 234, 167, 0.8)',
                                    'rgba(221, 160, 221, 0.8)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                },
                
                // è·å–æœ€è¿‘7å¤©çš„æ•°æ®
                getLast7DaysData() {
                    const days = [];
                    for (let i = 6; i >= 0; i--) {
                        const date = new Date();
                        date.setDate(date.getDate() - i);
                        const dateStr = date.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' });
                        
                        // ä»sessionsä¸­è·å–è¯¥å¤©çš„æ•°æ®
                        const daySessions = this.sessions.filter(session => {
                            const sessionDate = new Date(session.date);
                            return sessionDate.toDateString() === date.toDateString();
                        });
                        
                        const calories = daySessions.reduce((sum, session) => sum + (session.totalCalories || 0), 0);
                        const duration = daySessions.reduce((sum, session) => sum + (session.totalTime || 0), 0);
                        
                        days.push({
                            label: dateStr,
                            calories: Math.round(calories),
                            duration: duration,
                            workouts: daySessions.length
                        });
                    }
                    return days;
                },
                
                // è·å–åŠ¨ä½œç»Ÿè®¡
                getExerciseStats() {
                    const exerciseCount = {};
                    
                    this.sessions.forEach(session => {
                        session.exercises?.forEach(sessionEx => {
                            const exercise = this.exercises.find(ex => ex.id === sessionEx.exerciseId);
                            if (exercise && sessionEx.isCompleted) {
                                exerciseCount[exercise.name] = (exerciseCount[exercise.name] || 0) + 1;
                            }
                        });
                    });
                    
                    const sortedExercises = Object.entries(exerciseCount)
                        .sort(([,a], [,b]) => b - a)
                        .slice(0, 8); // åªæ˜¾ç¤ºå‰8ä¸ª
                    
                    return {
                        labels: sortedExercises.map(([name]) => name),
                        data: sortedExercises.map(([,count]) => count)
                    };
                },
                
                // è·å–èº«ä½“éƒ¨ä½ç»Ÿè®¡
                getBodyPartStats() {
                    const bodyPartCount = {};
                    
                    this.sessions.forEach(session => {
                        session.exercises?.forEach(sessionEx => {
                            const exercise = this.exercises.find(ex => ex.id === sessionEx.exerciseId);
                            if (exercise && sessionEx.isCompleted) {
                                bodyPartCount[exercise.bodyPart] = (bodyPartCount[exercise.bodyPart] || 0) + 1;
                            }
                        });
                    });
                    
                    return {
                        labels: Object.keys(bodyPartCount),
                        data: Object.values(bodyPartCount)
                    };
                },
                
                // ç”Ÿæˆæœ€è¿‘è®­ç»ƒæ—¥å†
                generateRecentDays() {
                    const days = [];
                    for (let i = 13; i >= 0; i--) { // æ˜¾ç¤ºæœ€è¿‘14å¤©
                        const date = new Date();
                        date.setDate(date.getDate() - i);
                        
                        const daySessions = this.sessions.filter(session => {
                            const sessionDate = new Date(session.date);
                            return sessionDate.toDateString() === date.toDateString();
                        });
                        
                        const totalCalories = daySessions.reduce((sum, session) => sum + (session.totalCalories || 0), 0);
                        
                        days.push({
                            date: date.toISOString(),
                            displayDate: date.getDate(),
                            hasWorkout: daySessions.length > 0,
                            workoutCount: daySessions.length,
                            totalCalories: totalCalories,
                            isToday: date.toDateString() === new Date().toDateString()
                        });
                    }
                    this.recentDays = days;
                },
                
                // åŠ è½½æœ€è¿‘è®­ç»ƒè®°å½•
                loadRecentSessions() {
                    this.recentSessions = this.sessions
                        .filter(session => session.isCompleted)
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .slice(0, 10); // åªæ˜¾ç¤ºæœ€è¿‘10æ¡è®°å½•
                },
                
                // æ ¹æ®workoutIdè·å–è®­ç»ƒè®¡åˆ’åç§°
                getWorkoutName(workoutId) {
                    const workout = this.workouts.find(w => w.id === workoutId);
                    return workout ? workout.name : 'æœªçŸ¥è®­ç»ƒ';
                },
                
                // åŠ¨ä½œç›¸å…³æ–¹æ³•
                editExercise(exercise) {
                    this.exerciseForm = { ...exercise };
                    this.showEditExerciseModal = true;
                },
                
                async deleteExercise(id) {
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåŠ¨ä½œå—ï¼Ÿ')) {
                        try {
                            await axios.delete(`/api/exercises/${id}`);
                            await this.loadExercises();
                        } catch (error) {
                            alert('åˆ é™¤å¤±è´¥: ' + error.response?.data?.error);
                        }
                    }
                },
                
                async saveExercise() {
                    try {
                        if (this.showEditExerciseModal) {
                            await axios.put(`/api/exercises/${this.exerciseForm.id}`, this.exerciseForm);
                        } else {
                            await axios.post('/api/exercises', this.exerciseForm);
                        }
                        await this.loadExercises();
                        this.closeExerciseModal();
                    } catch (error) {
                        alert('ä¿å­˜å¤±è´¥: ' + error.response?.data?.error);
                    }
                },
                
                closeExerciseModal() {
                    this.showAddExerciseModal = false;
                    this.showEditExerciseModal = false;
                    this.exerciseForm = {
                        id: '',
                        name: '',
                        description: '',
                        bodyPart: '',
                        imageUrl: ''
                    };
                },
                
                // è®­ç»ƒè®¡åˆ’ç›¸å…³æ–¹æ³•
                editWorkout(workout) {
                    this.workoutForm = { ...workout };
                    this.showEditWorkoutModal = true;
                },
                
                async deleteWorkout(id) {
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®­ç»ƒè®¡åˆ’å—ï¼Ÿ')) {
                        try {
                            await axios.delete(`/api/workouts/${id}`);
                            await this.loadWorkouts();
                        } catch (error) {
                            alert('åˆ é™¤å¤±è´¥: ' + error.response?.data?.error);
                        }
                    }
                },
                
                async saveWorkout() {
                    try {
                        if (this.showEditWorkoutModal) {
                            await axios.put(`/api/workouts/${this.workoutForm.id}`, this.workoutForm);
                        } else {
                            await axios.post('/api/workouts', this.workoutForm);
                        }
                        await this.loadWorkouts();
                        this.closeWorkoutModal();
                    } catch (error) {
                        alert('ä¿å­˜å¤±è´¥: ' + error.response?.data?.error);
                    }
                },
                
                closeWorkoutModal() {
                    this.showAddWorkoutModal = false;
                    this.showEditWorkoutModal = false;
                    this.workoutForm = {
                        id: '',
                        name: '',
                        description: '',
                        bodyPart: '',
                        exercises: []
                    };
                },
                
                addExerciseToWorkout() {
                    this.workoutForm.exercises.push({
                        exerciseId: '',
                        sets: 4,
                        reps: 12,
                        weight: 0,
                        restTime: 60
                    });
                },
                
                removeExerciseFromWorkout(index) {
                    this.workoutForm.exercises.splice(index, 1);
                },
                
                async startWorkout(workout) {
                    try {
                        const session = {
                            workoutId: workout.id,
                            exercises: workout.exercises.map(ex => ({
                                exerciseId: ex.exerciseId,
                                completedSets: 0,
                                completedReps: [],
                                actualRestTimes: [],
                                isCompleted: false
                            })),
                            isCompleted: false
                        };
                        
                        const response = await axios.post('/api/sessions', session);
                        const sessionId = response.data.id;
                        
                        // è·³è½¬åˆ°ç§»åŠ¨ç«¯è®­ç»ƒé¡µé¢
                        window.open(`/mobile?session=${sessionId}`, '_blank');
                    } catch (error) {
                        alert('å¯åŠ¨è®­ç»ƒå¤±è´¥: ' + error.response?.data?.error);
                    }
                },
                
                // æ–‡ä»¶ä¸Šä¼ ç›¸å…³æ–¹æ³•
                async onFileSelect(event) {
                    const file = event.target.files[0];
                    if (file) {
                        await this.uploadFile(file);
                    }
                },
                
                onDragOver(event) {
                    event.dataTransfer.dropEffect = 'copy';
                    event.target.classList.add('dragover');
                },
                
                onDragLeave(event) {
                    event.target.classList.remove('dragover');
                },
                
                async onDrop(event) {
                    event.target.classList.remove('dragover');
                    const file = event.dataTransfer.files[0];
                    if (file && file.type.startsWith('image/')) {
                        await this.uploadFile(file);
                    }
                },
                
                async uploadFile(file) {
                    try {
                        const formData = new FormData();
                        formData.append('file', file);
                        
                        const response = await axios.post('/api/upload', formData, {
                            headers: {
                                'Content-Type': 'multipart/form-data'
                            }
                        });
                        
                        this.exerciseForm.imageUrl = response.data.url;
                    } catch (error) {
                        alert('æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ' + error.response?.data?.error);
                    }
                },
                
                // å·¥å…·æ–¹æ³•
                getExerciseName(exerciseId) {
                    const exercise = this.exercises.find(ex => ex.id === exerciseId);
                    return exercise ? exercise.name : 'æœªçŸ¥åŠ¨ä½œ';
                },
                
                getWorkoutName(workoutId) {
                    const workout = this.workouts.find(w => w.id === workoutId);
                    return workout ? workout.name : 'æœªçŸ¥è®¡åˆ’';
                },
                
                formatDate(dateString) {
                    return new Date(dateString).toLocaleDateString('zh-CN');
                },
                
                formatTime(timeString) {
                    return new Date(timeString).toLocaleTimeString('zh-CN');
                },
                
                formatDuration(seconds) {
                    if (!seconds) return '0s';
                    const hours = Math.floor(seconds / 3600);
                    const minutes = Math.floor((seconds % 3600) / 60);
                    const secs = seconds % 60;
                    
                    if (hours > 0) {
                        return `${hours}h ${minutes}m ${secs}s`;
                    } else if (minutes > 0) {
                        return `${minutes}m ${secs}s`;
                    }
                    return `${secs}s`;
                },
                
                async filterSessions() {
                    try {
                        let url = '/api/sessions';
                        if (this.filterStartDate && this.filterEndDate) {
                            url += `?start=${this.filterStartDate}&end=${this.filterEndDate}`;
                        }
                        const response = await axios.get(url);
                        this.sessions = response.data || [];
                    } catch (error) {
                        console.error('ç­›é€‰è®­ç»ƒè®°å½•å¤±è´¥:', error);
                    }
                }
            },
            
            watch: {
                activeTab(newTab) {
                    if (newTab === 'statistics') {
                        // å»¶è¿Ÿæ‰§è¡Œç¡®ä¿DOMå·²æ›´æ–°
                        this.$nextTick(() => {
                            this.initializeCharts();
                            this.generateRecentDays();
                            this.loadRecentSessions();
                        });
                    }
                }
            },
            
            async mounted() {
                await this.loadExercises();
                await this.loadWorkouts();
                await this.loadSessions();
                await this.loadStatistics();
            }
        }).mount('#app');
    </script>
</body>
</html>
